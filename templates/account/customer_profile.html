<!-- account/templates/account/customer_profile.html -->
<!DOCTYPE html>
<html>
<head>
    <title>پروفایل مشتری</title>
</head>
<body>
    <h1>پروفایل شما</h1>
    <p>خوش آمدید، {{ user.username }}!</p>
    <p>نام: {{ user.first_name|default:"ثبت نشده" }}</p>
    <p>نام خانوادگی: {{ user.last_name|default:"ثبت نشده" }}</p>
    <p>ایمیل: {{ user.email|default:"ثبت نشده" }}</p>
    <p>نقش: {{ user.role|default:"-" }}</p>
    <p>شماره تلفن: {{ user.phone|default:"ثبت نشده" }}</p>

    <a href="{% url 'account:edit_customer_profile' %}">ویرایش پروفایل</a>
    <br><br>

    <h2>جستجوی آرایشگاه</h2>
    <form method="get">
        <input type="text" name="search" value="{{ search_query }}" placeholder="نام یا کد آرایشگاه را وارد کنید">
        <button type="submit">جستجو</button>
    </form>

    {% if search_results %}
        <h3>نتایج جستجو:</h3>
        <ul>
        {% for shop in search_results %}
            <li>
                {{ shop.name }} (کد: {{ shop.referral_code }})
                {% if shop.id in customer_shop_ids %}
                    <span>(شما عضو هستید)</span>
                {% else %}
                    <a href="{% url 'account:join_shop' shop.id %}">عضویت</a>
                {% endif %}
            </li>
        {% endfor %}
        </ul>
    {% elif search_query %}
        <p>آرایشگاهی با این مشخصات پیدا نشد.</p>
    {% endif %}

    <h2>آرایشگاه‌های شما</h2>
    {% if customer_shops %}
        <ul>
        {% for customer_shop in customer_shops %}
            <li>
                {{ customer_shop.shop.name }} (کد: {{ customer_shop.shop.referral_code }}) - عضویت از: {{ customer_shop.joined_at }}
                <a href="{% url 'account:leave_shop' customer_shop.shop.id %}">لغو عضویت</a>|
                <a href="{% url 'salon:book_appointment' %}">نوبت</a>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>شما هنوز عضو هیچ آرایشگاهی نشده‌اید.</p>
    {% endif %}

    <form method="post" action="{% url 'account:logout' %}">
        {% csrf_token %}
        <button type="submit">خروج</button>
    </form>
</body>
</html>